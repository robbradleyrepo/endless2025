/*eslint-disable */
'use strict';

$(document).ready(function () {

	/***************************/
	// MASTER INTRO VIDEO OPTION
	/***************************/
	$(".page-wrap").fadeIn(500);

	// if no touch
	if (!Modernizr.touch) {
		function goVideo() {

			$('.gateway-screen').animate({
				top: '-101%'
			}, 300);

			if ($('body').hasClass('sound-on')) {
				//play robot
				$('.botfx').get(0).play();
				$('body').removeClass('disable');
				$('.video-master').animate({
					transform: 'translateY(-100%)'
				}, 300);
				$(".page-wrap").delay(200).fadeIn(800);
				$(".page-wrap").promise().done(function () {
					$('.video-master').remove();
				});
			} else {
				$('body').removeClass('disable');
				$('body').find('audio').attr('muted');
				$('body').find('.indicators').hide();
			}
		};

		if (window.location.pathname == '/' || window.location.pathname == '/index') {

			$('body').addClass('disable');
			$(".gateway-screen").fadeIn(300);
			$('body').removeClass('sound-on');

			$('.fx').on('click', function (e) {
				e.preventDefault;
				$('body').addClass('sound-on');
				goVideo();
			});
		} else {
			// Other page - fade in as normal
			$(".page-wrap").fadeIn(500);
			$('body').removeClass('disable');
		}
	} else {
		$(".gateway-screen").hide();
		$(".page-wrap").fadeIn(500);
		//no touch
		$('body').removeClass('disable');
	}

	/******************************************/
	/* Disable right click for save images    */
	/******************************************/

	$('img').bind('contextmenu', function (e) {
		return false;
	});

	/******************************************/
	/* MOBILE menu    */
	/******************************************/

	$('.nav-close').click(function (e) {
		e.preventDefault();
		$('.sliding-panel-content,.sliding-panel-fade-screen').removeClass('is-visible');
		$('body').removeClass('disable');
	});

	$('#mobile-nav .nav-link').click(function (e) {
		//e.preventDefault();
		$('.sliding-panel-content,.sliding-panel-fade-screen').removeClass('is-visible');
		$('body').removeClass('disable');
	});

	$('.js-menu-trigger,.sliding-panel-fade-screen,.sliding-panel-close').on('click touchstart', function (e) {
		//console.log('menu icon clicked');
		$('.sliding-panel-content,.sliding-panel-fade-screen').toggleClass('is-visible');
		$('body').toggleClass('disable');
		e.preventDefault();
	});

	function globalBarbaFunctions() {
		$('img').bind('contextmenu', function (e) {
			return false;
		});

		var clickCount = 0;
		clickCount = clickCount == 5 ? 0 : clickCount;

		// GOLD ANIMATION w/ sounds
		$('.gold-trigger').click(function (e) {
			e.preventDefault();
			$('.gold-img').addClass('gold-active');
			$('.gold-img')
				.on('webkitAnimationEnd oanimationend msAnimationEnd animationend', function (e) {
					$(this).removeClass('gold-active');
				});

			if (clickCount == 0) { $('.songs').get(0).play(); clickCount++; }
			else if (clickCount == 1) { $('.songs').get(1).play(); clickCount++; }
			else if (clickCount == 2) { $('.songs').get(2).play(); clickCount++; }
			else if (clickCount == 3) { $('.songs').get(3).play(); clickCount++; }
			else if (clickCount == 4) { $('.songs').get(4).play(); clickCount = 0; }
		});

		$('.print-button').click(function (e) {
			e.preventDefault();
			$(this).toggleClass('active');
			$(this).siblings('.artwork-copy').toggleClass('inactive');
			$(this).siblings('.print-copy').toggleClass('active');
		});

		// nav selected states
		$("#primary-nav a").removeClass("nav-active");
		if (window.location.href.indexOf("index") > -1) {
			$("#primary-nav a.nav-home").addClass("nav-active");
		}
		if (window.location.href.indexOf("about") > -1) {
			$("#primary-nav a.nav-about").addClass("nav-active");
		} else if (window.location.href.indexOf("artwork") > -1) {
			$("#primary-nav a.nav-artwork").addClass("nav-active");
		} else if (window.location.href.indexOf("exhibitions") > -1) {
			$("#primary-nav a.nav-exhibitions").addClass("nav-active");
		} else if (window.location.href.indexOf("field") > -1) {
			$("#primary-nav a.nav-field").addClass("nav-active");
		} else if (window.location.href.indexOf("press") > -1) {
			$("#primary-nav a.nav-press").addClass("nav-active");
		} else if (window.location.href.indexOf("subscribe") > -1) {
			$("#primary-nav a.nav-subscribe").addClass("nav-active");
		} else if (window.location.href.indexOf("contact") > -1) {
			$("#primary-nav a.nav-contact").addClass("nav-active");
		}
		else if (window.location.href.indexOf("books") > -1) {
			$("#primary-nav a.nav-books").addClass("nav-active");
		}

		$('html, body').animate({
			scrollTop: "0px"
		}, 800);

		$('.back-top').click(function (e) {
			e.preventDefault();
			$('html, body').animate({
				scrollTop: "0px"
			}, 200);
		});

		if (window.location.href.indexOf("press") > -1) {
			const linkList = document.getElementById('press-articles');
			const links = linkList.getElementsByTagName('a');

			for (let link of links) {
				// Trim any leading or trailing spaces in the href attribute
				link.href = link.href.trim();
				link.setAttribute('target', '_blank');
			}
		}

		if (window.location.href.indexOf("exhibitions") > -1) {

			$('.exhibitions-slider').slick({
				dots: true,
				infinite: true,
				speed: 500,
				fade: true,
				cssEase: 'linear',
				slidesToShow: 1,
				slidesToScroll: 1,
				autoplay: true,
				autoplaySpeed: 2000,
			});

		}
	};

	var FadeTransition = Barba.BaseTransition.extend({
		start: function start() {
			Promise.all([this.newContainerLoading, this.fadeOut()]).then(this.fadeIn.bind(this));
		},

		fadeOut: function fadeOut() {
			return $(this.oldContainer).animate({ opacity: 0 }).promise();
		},

		fadeIn: function fadeIn() {

			var _this = this;
			var $el = $(this.newContainer);

			$(this.oldContainer).hide();

			$el.css({
				visibility: 'visible',
				opacity: 0
			});

			$el.animate({ opacity: 1 }, 400, function () {
				_this.done();
			});
		}
	});

	Barba.Pjax.getTransition = function () {
		return FadeTransition;
	};

	Barba.Pjax.start();

	Barba.Dispatcher.on('newPageReady', function (currentStatus, oldStatus, container) {
		return globalBarbaFunctions();
	});

	Barba.Dispatcher.on('transitionCompleted', function (currentStatus, oldStatus, container) {

	});

	return globalBarbaFunctions();


});
// end doc ready

